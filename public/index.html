<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="/style/index.css">
    <link rel="stylesheet" href="/style/proto.css">
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
        integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO"
        crossorigin="anonymous"></script>
    <title>Pose Detection</title>
    <style>
        .video-container {
            position: relative;
        }

        video,
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <div class="video-container">
        <video class="local-video" autoplay playsinline></video>
        <canvas id="local-canva"></canvas>
    </div>
    <script type="module">
        import PoseDetection from './poseDetection.js';

        // Connect to the WebSocket server
        const socket = io('http://localhost:5000'); // Make sure to match your server address

        // Function to start the webcam
        async function setupWebcam() {
            const video = document.querySelector('.local-video');
            const stream = await navigator.mediaDevices.getUserMedia({
                video: true
            });
            video.srcObject = stream;
            return stream;
        }

        async function startPoseDetection() {
            // Get webcam stream
            const stream = await setupWebcam();

            // Create PoseDetection instance and start detection
            const poseDetection = new PoseDetection(stream);

            // Set a callback function to process the results
            poseDetection.setResultCallback((result, canvasWidth, canvasHeight) => {
                console.log('Pose Landmarks:', result);

                // Send the result to the WebSocket server
                socket.emit('poseData', result);
            });


            socket.on('poseDetectionResult',(data)=> {handleDetection(data)})


            // Initialize and start the detection
            await poseDetection.init();
        }

        async function handleDetection(data) {
            const { accuracy, correct, correct2 } = data;

            poseDetection.setCorrectPoints(correct, correct2);

        }

        // Start the pose detection once the page loads
        window.onload = () => {
            startPoseDetection();
        };
    </script>
</body>

</html>